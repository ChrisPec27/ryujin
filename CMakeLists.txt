SET(RYUJIN_VERSION 0.0.1)

CMAKE_MINIMUM_REQUIRED(VERSION 3.10)

FIND_PACKAGE(deal.II 9.0 REQUIRED HINTS ${DEAL_II_DIR} $ENV{DEAL_II_DIR})
DEAL_II_INITIALIZE_CACHED_VARIABLES()
DEAL_II_QUERY_GIT_INFORMATION()

IF(NOT DEAL_II_WITH_MPI OR NOT DEAL_II_WITH_THREADS OR NOT DEAL_II_WITH_P4EST)
  MESSAGE(FATAL_ERROR
    "Need a deal.II library with threads, mpi and p4est support enabled."
    )
ENDIF()

IF(CMAKE_CXX_COMPILER MATCHES "clang")
  SET(DEAL_II_CXX_FLAGS "${DEAL_II_CXX_FLAGS} -Xclang -fcolor-diagnostics -Qunused-arguments")
  SET(DEAL_II_LINKER_FLAGS "${DEAL_II_LINKER_FLAGS} -Wl,-as-needed")

  SET(DEAL_II_CXX_FLAGS_DEBUG
    "${DEAL_II_CXX_FLAGS_DEBUG} -fsanitize=address -fsanitize-address-use-after-scope"
    )
  SET(DEAL_II_LINKER_FLAGS_DEBUG
    "${DEAL_II_LINKER_FLAGS_DEBUG} -fsanitize=address -fsanitize-address-use-after-scope"
    )
ENDIF()

PROJECT(ryujin CXX)

IF(POLICY CMP0042)
  CMAKE_POLICY(SET CMP0042 NEW)
ENDIF()

ADD_SUBDIRECTORY(grendel)
ADD_SUBDIRECTORY(ryujin)

ENABLE_TESTING()
ADD_SUBDIRECTORY(tests)
